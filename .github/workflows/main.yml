import os
import requests
from datetime import datetime, timedelta, timezone
import yfinance as yf

# 手順1でコピーしたURLをGitHubのSecret(名前: GAS_URL)に入れるか、ここに直接貼る
GAS_URL = os.getenv("https://script.google.com/macros/s/AKfycbyKC_4zsHQukBfyJVAR0vBV38uW2C043X0cAeW4fJnJTt3bIdNyrT-zDfbfm-MgXvUTvg/exec") 

def run_strategy():
    jst = timezone(timedelta(hours=9))
    now = datetime.now(jst)
    
    if now.day % 5 != 0: return

    ticker = yf.Ticker("USDJPY=X")
    price = ticker.history(period="1d")['Close'].iloc[-1]
    
    # スプレッドシートに送るデータ
    data = {
        "date": now.strftime("%Y/%m/%d"),
        "strategy": "ゴトー日ロング",
        "price": round(price, 3)
    }

    # GASに送信！
    try:
        response = requests.post(GAS_URL, json=data)
        print(f"GAS Response: {response.text}")
    except Exception as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    run_strategy()
